#!/bin/sh

CWD=`pwd`
BASE=`basename "$CWD"`
DIR=`dirname "$CWD"`
FILENAME="$DIR/$BASE-installpkg"

(if [ -n "$1" ];
then
	printf "%s\n" "$@"
else
	dpkg-checkbuilddeps 2>&1 | perl -pe 's/^.*dependencies: //'
fi) | \
	perl -E '$_=join(" ",<>);' \
	-E '@x = split /\s+/, s/([a-z0-9.-]+)(\s*\|\s*([a-z0-9.-]+))*/$1/gr;' \
	-E 'print join(" ", (grep{ !m/(^\(|\)$) / } @x)), "\n";' \
	>> "$FILENAME"

sudo aptitude --without-recommends install $(cat "$FILENAME")
